<!DOCTYPE html><html lang=zh-CN data-default-color-scheme=auto><head><meta charset=UTF-8><link rel=apple-touch-icon sizes=76x76 href=/img/favicon/favicon.png><link rel=icon href=/img/favicon/favicon.png><link rel=canonical href=https://justloseit.top/拜占庭共识中的“蜜獾”/ ><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content=#2f4154><meta name=author content="Mobilis In Mobili"><meta name=keywords content=""><meta name=description content="大名鼎鼎的异步共识论文《The Honey Badger of BFT Protocols》的笔记（异步真令人绝望.jpg）"><meta property=og:type content=article><meta property=og:title content=拜占庭共识中的“蜜獾”><meta property=og:url content=https://justloseit.top/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%85%B1%E8%AF%86%E4%B8%AD%E7%9A%84%E2%80%9C%E8%9C%9C%E7%8D%BE%E2%80%9D/index.html><meta property=og:site_name content=动中之动><meta property=og:description content="大名鼎鼎的异步共识论文《The Honey Badger of BFT Protocols》的笔记（异步真令人绝望.jpg）"><meta property=og:locale content=zh_CN><meta property=og:image content=https://justloseit.top/img/index/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%85%B1%E8%AF%86%E4%B8%AD%E7%9A%84%E2%80%9C%E8%9C%9C%E7%8D%BE%E2%80%9D.jpg><meta property=article:published_time content=2022-11-14T06:31:25.000Z><meta property=article:modified_time content=2023-05-17T05:11:03.114Z><meta property=article:author content="Mobilis In Mobili"><meta property=article:tag content=区块链><meta property=article:tag content=共识><meta property=article:tag content=异步><meta name=twitter:card content=summary_large_image><meta name=twitter:image content=https://justloseit.top/img/index/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%85%B1%E8%AF%86%E4%B8%AD%E7%9A%84%E2%80%9C%E8%9C%9C%E7%8D%BE%E2%80%9D.jpg><title>拜占庭共识中的“蜜獾” - 动中之动</title><link rel=stylesheet href=https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css><link rel=stylesheet href=https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css><link rel=stylesheet href=https://lib.baomitu.com/hint.css/2.7.0/hint.min.css><link rel=stylesheet href=https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css><link rel=stylesheet href=https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css><link rel=stylesheet href=//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css><link rel=stylesheet href=//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css><link rel=stylesheet href=/css/main.css><link id=highlight-css rel=stylesheet href=/css/highlight.css><link id=highlight-css-dark rel=stylesheet href=/css/highlight-dark.css><script id=fluid-configs>var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"justloseit.top",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:60,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:"§"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!1,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},leancloud:{app_id:"snI2XNrHrhyx5g84m3Uim3EC-gzGzoHsz",app_key:"x2YseXJIHmvnsM4v9y9UAlvu",server_url:"https://sni2xnrh.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null}},search_path:"/local-search.xml",include_content_in_search:!0});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src=/js/utils.js></script><script src=/js/color-schema.js></script><meta name=generator content="Hexo 5.4.2"><link rel=alternate href=/atom.xml title=动中之动 type=application/atom+xml></head><body><header><div class=header-inner style=height:70vh><nav id=navbar class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class=container><a class=navbar-brand href=/ ><strong>Mobilis In Mobili</strong> </a><button id=navbar-toggler-btn class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation"><div class=animated-icon><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto text-center"><li class=nav-item><a class=nav-link href=/ target=_self><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class=nav-item><a class=nav-link href=/archives/ target=_self><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class=nav-item><a class=nav-link href=/categories/ target=_self><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class=nav-item><a class=nav-link href=/tags/ target=_self><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class=nav-item><a class=nav-link href=/about/ target=_self><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class=nav-item><a class=nav-link href=/links/ target=_self><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class=nav-item id=search-btn><a class=nav-link target=_self href=javascript:; data-toggle=modal data-target=#modalSearch aria-label=Search><i class="iconfont icon-search"></i></a></li><li class=nav-item id=color-toggle-btn><a class=nav-link target=_self href=javascript:; aria-label="Color Toggle"><i class="iconfont icon-dark" id=color-toggle-icon></i></a></li></ul></div></div></nav><div id=banner class=banner parallax=true style="background:url(/img/banner/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%85%B1%E8%AF%86%E4%B8%AD%E7%9A%84%E2%80%9C%E8%9C%9C%E7%8D%BE%E2%80%9D.jpg) no-repeat center center;background-size:cover"><div class=full-bg-img><div class="mask flex-center" style=background-color:rgba(0,0,0,.3)><div class="banner-text text-center fade-in-up"><div class=h2><span id=subtitle data-typed-text=拜占庭共识中的“蜜獾”></span></div><div class=mt-3><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden=true></i> Mobilis In Mobili </span><span class=post-meta><i class="iconfont icon-date-fill" aria-hidden=true></i> <time datetime="2022-11-14 14:31" pubdate>2022年11月14日 下午</time></span></div><div class=mt-1><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.5k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 30 分钟 </span><span id=leancloud-page-views-container class=post-meta style=display:none><i class="iconfont icon-eye" aria-hidden=true></i> <span id=leancloud-page-views></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id=board-ctn><div id=board><article class="post-content mx-auto"><h1 id=seo-header>拜占庭共识中的“蜜獾”</h1><p id=updated-time class="note note-info">本文最后更新于 2023年5月17日 下午</p><div class=markdown-body><p>大名鼎鼎的异步共识论文《The Honey Badger of BFT Protocols》的笔记（异步真令人绝望.jpg）</p><span id=more></span><blockquote><p>加密货币在高度对抗的环境中茁壮成长，在这种环境中，预计会有动机明确的恶意攻击。出于这个原因，许多比特币的热心支持者将其称为“货币中的<strong>蜜獾</strong>”。</p></blockquote><ul><li>论文自称其为拜占庭共识中的“蜜獾”，足见其想法之大。</li></ul><h1 id=the-honey-badger-of-bft-protocols><a class=markdownIt-Anchor href=#the-honey-badger-of-bft-protocols></a> The Honey Badger of BFT Protocols</h1><h2 id=论文背景><a class=markdownIt-Anchor href=#论文背景></a> 论文背景</h2><ul><li><p>FLP 不可能定理：在<strong>纯异步环境</strong>下不可能存在一种<strong>确定性</strong>的共识协议</p><ul><li>做出一些更强的时序假设</li><li>使用随机性的共识协议 ✅</li></ul></li><li><p>做出一些更强的时序假设</p><ul><li><p>从网络分区中恢复得很慢：一个节点崩溃了，网络被暂时分割，持续时间为 <span class=katex><span class=katex-mathml><math><semantics><mrow><msup><mn>2</mn><mi>D</mi></msup><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>2^D\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8413309999999999em;vertical-align:0></span><span class=mord><span class=mord>2</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8413309999999999em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.02778em>D</span></span></span></span></span></span></span></span><span class=mord>Δ</span></span></span></span>。修复网络后， 协议必须等待另一个 <span class=katex><span class=katex-mathml><math><semantics><mrow><msup><mn>2</mn><mo stretchy=false>(</mo></msup><mi>D</mi><mo>+</mo><mn>1</mn><mo stretchy=false>)</mo><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>2^(D+1)\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9713299999999999em;vertical-align:-.08333em></span><span class=mord><span class=mord>2</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8879999999999999em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mopen mtight">(</span></span></span></span></span></span></span></span><span class="mord mathdefault" style=margin-right:.02778em>D</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>1</span><span class=mclose>)</span><span class=mord>Δ</span></span></span></span> 的间隔才能开始选举一个新的领导者</p></li><li><p>稳健性和响应性之间的权衡：参数 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=mord>Δ</span></span></span></span> 的选取是复杂的</p></li></ul></li></ul><h2 id=论文贡献><a class=markdownIt-Anchor href=#论文贡献></a> 论文贡献</h2><ul><li><p>时序假设被证明是脆弱的</p><ul><li>明确地构建了一个<strong>对抗性 “间歇同步 ”网络</strong>，使得 PBFT 等弱同步协议陷入停顿</li></ul></li><li><p>实用异步拜占庭共识</p><ul><li>提出了 HoneyBadgerBFT，这是<strong>第一个在异步情况下提供最佳渐进效率 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>𝑂</mi><mo stretchy=false>(</mo><mi>N</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>𝑂(N)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathdefault" style=margin-right:.02778em>O</span><span class=mopen>(</span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mclose>)</span></span></span></span> 的 BFT 原子广播协议</strong>。</li><li>乐观情况下实验，PBFT 可达到的吞吐量随着节点数量的增加而减少，而 HoneyBadgerBFT 的<strong>吞吐量大致保持不变</strong>。</li><li>PBFT 在面对对抗性 “间歇同步 ”网络时将实现零吞吐量，而HoneyBadgerBFT 将<strong>以正常的速度完成周期</strong>。</li></ul></li></ul><h2 id=构建对抗性-间歇同步-网络><a class=markdownIt-Anchor href=#构建对抗性-间歇同步-网络></a> 构建对抗性 “间歇同步 ”网络</h2><ul><li><p>对抗性 “间歇同步 ”网络由<strong>调度器</strong>控制</p></li><li><p>调度器构建思路</p><ul><li>PBFT 协议在很大程度上依赖于弱同步网络的有效性。如果没有取得进展，要么是因为领导者有问题，要么是因为网络停滞不前。而节点就会<strong>试图选举一个新的领导者</strong></li><li>对 PBFT 的攻击，调度器<strong>不会丢弃或重新排序</strong>任何消息，而只是延迟将消息传递到当前领导者的任何节点</li></ul></li><li><p>调度器构建步骤</p><ul><li>首先，我们假设有一个节点崩溃了。然后，每当一个正确的节点成为领导者时，网络就会延迟消息，阻止进展，并导致下一个节点以轮流的方式成为新的领导者</li><li>当<strong>崩溃的节点成为下一个领导者</strong>时，调度器立即修复网络分区，并在诚实的节点之间非常迅速地传递消息；然而，由于领导者已经崩溃，这里也没有取得进展</li></ul></li></ul><h3 id=对抗性-间歇同步-网络实例><a class=markdownIt-Anchor href=#对抗性-间歇同步-网络实例></a> 对抗性 “间歇同步 ”网络实例</h3><ul><li>符号定义</li></ul><div align=center><img src=/img/post/拜占庭共识中的“蜜獾”/符号定义.png style=zoom:50%></div><div class="note note-success"><p><span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>0\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=mord>0</span><span class=mord>Δ</span></span></span></span> → <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>1</mn><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>1\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=mord>1</span><span class=mord>Δ</span></span></span></span> → <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>3</mn><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>3\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=mord>3</span><span class=mord>Δ</span></span></span></span> → <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>7</mn><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>7\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=mord>7</span><span class=mord>Δ</span></span></span></span>，原因是 PBFT 每次视图切换后，超时间隔翻倍</p></div><h4 id=0delta-阶段><a class=markdownIt-Anchor href=#0delta-阶段></a> <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>0</mn><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>0\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=mord>0</span><span class=mord>Δ</span></span></span></span> 阶段</h4><div align=center><img src="/img/post/拜占庭共识中的“蜜獾”/T0 阶段.png" srcset="/img/loading.gif" lazyload style=zoom:50%></div><ul><li><p>故障副本 0 最初是领导者，它会保留 <code>PRE_PREPARE</code> 消息的时间超过超时时间 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=mord>Δ</span></span></span></span></p></li><li><p>这会触发所有节点增加其视图计数器并为视图编号 1 广播 <code>VIEW_CHANGE</code> 消息</p></li></ul><h4 id=1delta-阶段><a class=markdownIt-Anchor href=#1delta-阶段></a> <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>1</mn><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>1\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=mord>1</span><span class=mord>Δ</span></span></span></span> 阶段</h4><div align=center><img src="/img/post/拜占庭共识中的“蜜獾”/T1 阶段.png" srcset="/img/loading.gif" lazyload style=zoom:50%></div><ul><li>调度器<strong>推迟</strong>了所有 <code>VIEW_CHANGE</code> 消息对副本 1（视图 1 的领导者）的传递</li><li>其余节点的视图改变操作<strong>超时</strong>，因为它们没有从副本 1 收到有效的 <code>NEW_VIEW</code> 消息</li></ul><h4 id=3delta-阶段><a class=markdownIt-Anchor href=#3delta-阶段></a> <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>3</mn><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>3\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=mord>3</span><span class=mord>Δ</span></span></span></span> 阶段</h4><div align=center><img src="/img/post/拜占庭共识中的“蜜獾”/T3 阶段1.png" srcset="/img/loading.gif" lazyload style=zoom:50%></div><ul><li>节点 0、2 和 3 将他们的视图计数器增加到 2，并广播另一个 <code>VIEW_CHANGE</code> 消息</li><li>此时，<strong>视图 1</strong> 的 <code>VIEW_CHANGE</code> 消息被传递给副本 1，副本1通过在<strong>视图 1</strong> 中广播一个 <code>NEW_VIEW</code> 和一个 <code>PRE_PREPARE</code> 消息来回应</li></ul><div align=center><img src="/img/post/拜占庭共识中的“蜜獾”/T3 阶段2.png" srcset="/img/loading.gif" lazyload style=zoom:50%></div><ul><li>副本 1 通过在视图 1 中广播一个 <code>NEW_VIEW</code> 和一个 <code>PRE_PREPARE</code> 消息<strong>被所有其他节点忽略</strong>，因为<strong>它们已经进展到了视图编号 2</strong><br>然后，副本 1 将收到视图 2 的 <code>VIEW_CHANGE</code> 消息，并相应增加其视图计数器</li></ul><h4 id=7delta-阶段><a class=markdownIt-Anchor href=#7delta-阶段></a> <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>7</mn><mi mathvariant=normal>Δ</mi></mrow><annotation encoding=application/x-tex>7\Delta</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=mord>7</span><span class=mord>Δ</span></span></span></span> 阶段</h4><div align=center><img src="/img/post/拜占庭共识中的“蜜獾”/T7 阶段.png" srcset="/img/loading.gif" lazyload style=zoom:50%></div><ul><li>调度器会<strong>推迟所有 <code>VIEW_CHANGE</code> 消息对副本 2 的传递</strong>，确保所有其他节点的视图改变操作再次超时</li><li>这个过程将持续到有问题的副本 0 再次被选为领导者，这时调度器将加速传递所有消息，而副本 0 则<strong>扣留相应的 <code>NEW_VIEW</code> 和 <code>PRE_PREPARE</code> 消息</strong>以触发另一个视图变化，并<strong>重复这个循环</strong></li></ul><div class="note note-primary"><p><strong>只要调度器扣留预定的非故障领导者的 <code>VIEW_CHANGE</code> 消息的时间超过（指数级增加的）超时间隔</strong>，这个循环就可以无限期地继续下去，阻止任何视图改变成功，并阻止协议<strong>取得任何进展</strong>。</p></div><h2 id=honeybadgerbft-方案><a class=markdownIt-Anchor href=#honeybadgerbft-方案></a> HoneyBadgerBFT 方案</h2><ul><li><p>模型假设</p><ul><li>纯异步网络：</li><li>静态拜占庭故障：<span class=katex><span class=katex-mathml><math><semantics><mrow><mn>3</mn><mi mathvariant=normal>ｆ</mi><mo>+</mo><mn>1</mn><mo>≤</mo><mi>N</mi></mrow><annotation encoding=application/x-tex>3ｆ+1\leq N</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.72777em;vertical-align:-.08333em></span><span class=mord>3</span><span class="mord cjk_fallback">ｆ</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.78041em;vertical-align:-.13597em></span><span class=mord>1</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.10903em>N</span></span></span></span></li><li>受信任的设置：初始设置阶段与受信任的密钥分发者交互</li></ul></li><li><p>分布式计算中的共识等价问题</p><ul><li>相等问题<ul><li>原子广播：Hadzilacos and Toueg, 1994</li><li>状态机复制：Schneider, 1990</li></ul></li><li>相关问题<ul><li>集群管理：Guerraoui and Schiper, 2001</li><li>非阻塞原子提交：Guerraoui and Schiper, 2001</li></ul></li></ul></li></ul><div class="note note-primary"><p>HoneyBadgerBFT 方案实际上是实现了<strong>原子广播</strong></p></div><h3 id=原子广播><a class=markdownIt-Anchor href=#原子广播></a> 原子广播</h3><ul><li>原子广播协议必须满足以下属性，所有这些属性都应在异步网络中以高概率成立，并且不受任意对手的影响<ul><li>一致性：如果任何正确的节点输出交易 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><annotation encoding=application/x-tex>\mathrm{tx}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.61508em;vertical-align:0></span><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span></span></span></span>，那么每个正确的节点都输出 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><annotation encoding=application/x-tex>\mathrm{tx}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.61508em;vertical-align:0></span><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span></span></span></span>（安全性）</li><li>全序性：如果一个正确的节点输出了交易序列 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo fence=true>⟨</mo><msub><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><mn>0</mn></msub><mo separator=true>,</mo><msub><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><mn>1</mn></msub><mo separator=true>,</mo><mo>…</mo><msub><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><mi>j</mi></msub><mo fence=true>⟩</mo></mrow><annotation encoding=application/x-tex>\left\langle\mathrm{tx}_0, \mathrm{tx}_1, \ldots \mathrm{tx}_j\right\rangle</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.036108em;vertical-align:-.286108em></span><span class=minner><span class="mopen delimcenter" style=top:0>⟨</span><span class=mord><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner>…</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>⟩</span></span></span></span></span> ，而另一个正确的节点输出了 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo fence=true>⟨</mo><msubsup><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><mn>0</mn><mo mathvariant=normal>′</mo></msubsup><mo separator=true>,</mo><msubsup><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><mn>1</mn><mo mathvariant=normal>′</mo></msubsup><mo separator=true>,</mo><mo>…</mo><msubsup><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><mi>j</mi><mo mathvariant=normal>′</mo></msubsup><mo fence=true>⟩</mo></mrow><annotation encoding=application/x-tex>\left\langle\mathrm{tx}_0^{\prime}, \mathrm{tx}_1^{\prime}, \ldots \mathrm{tx}_j^{\prime}\right\rangle</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.239792em;vertical-align:-.389792em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size1">⟨</span></span><span class=mord><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.756872em><span style=top:-2.4530000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style=top:-3.0679800000000004em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.247em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.756872em><span style=top:-2.4530000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style=top:-3.0679800000000004em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.247em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner>…</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.756872em><span style=top:-2.4463160000000004em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span><span style=top:-3.0679800000000004em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.389792em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0><span class="delimsizing size1">⟩</span></span></span></span></span></span>，则对 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>i</mi><mo>≤</mo><mi>min</mi><mo>⁡</mo><mrow><mo fence=true>(</mo><mi>j</mi><mo separator=true>,</mo><msup><mi>j</mi><mo mathvariant=normal>′</mo></msup><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>i \leq \min \left(j, j^{\prime}\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.79549em;vertical-align:-.13597em></span><span class="mord mathdefault">i</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>≤</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:1.001892em;vertical-align:-.25em></span><span class=mop>min</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class="mord mathdefault" style=margin-right:.05724em>j</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class="mord mathdefault" style=margin-right:.05724em>j</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.751892em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>)</span></span></span></span></span>， 有 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><mi>i</mi></msub><mo>=</mo><msubsup><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><mi>i</mi><mo mathvariant=normal>′</mo></msubsup></mrow><annotation encoding=application/x-tex>\mathrm{tx}_i=\mathrm{tx}_i^{\prime}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.76508em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:1.010556em;vertical-align:-.253684em></span><span class=mord><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.756872em><span style=top:-2.4463160000000004em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style=top:-3.0679800000000004em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.253684em><span></span></span></span></span></span></span></span></span></span> 成立（安全性）</li><li>抗审查攻击：如果一个交易 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>t</mi><mi mathvariant=normal>x</mi></mrow><annotation encoding=application/x-tex>\mathrm{tx}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.61508em;vertical-align:0></span><span class=mord><span class="mord mathrm">t</span><span class="mord mathrm">x</span></span></span></span></span> 被输入到 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi><mo>−</mo><mi>f</mi></mrow><annotation encoding=application/x-tex>N-f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.76666em;vertical-align:-.08333em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.10764em>f</span></span></span></span> 个正确的节点，那么它最终会被每个正确的节点输出（活性）</li></ul></li></ul><h3 id=总体设计><a class=markdownIt-Anchor href=#总体设计></a> 总体设计</h3><div align=center><img src=/img/post/拜占庭共识中的“蜜獾”/总体设计.png style=zoom:50%></div><ul><li><p>HoneyBadgerBFT 通过 ACS(Asynchronous Common Subset, 异步公共子集) 实现了 ABC(Atomic Broadcast, 原子广播)。ACS 可以通过 MVBA(Multi-value Validated Byzantine Agreement, 多值拜占庭共识) 实现，但是 MVBA 原始协议有 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>O</mi><mo stretchy=false>(</mo><msup><mi>N</mi><mn>3</mn></msup><mi mathvariant=normal>∣</mi><mi>v</mi><mi mathvariant=normal>∣</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>O(N^3|v|)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.064108em;vertical-align:-.25em></span><span class="mord mathdefault" style=margin-right:.02778em>O</span><span class=mopen>(</span><span class=mord><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141079999999999em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class=mord>∣</span><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=mord>∣</span><span class=mclose>)</span></span></span></span> 的开销，所以论文考虑了另一条路线。（DumboBFT 实际就是继续把 MVBA 这条路走下去了）</p></li><li><p>另一条路，RBC(Reliable Broadcast, 可靠广播) + ABA(Asynchronous Binary Agreement, 异步二元共识) 。通过<strong>纠错码</strong>，RBC 的复杂度从 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>O</mi><mrow><mo fence=true>(</mo><msup><mi>N</mi><mn>2</mn></msup><mi mathvariant=normal>∣</mi><mi>v</mi><mi mathvariant=normal>∣</mi><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>O\left(N^2|v|\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.20001em;vertical-align:-.35001em></span><span class="mord mathdefault" style=margin-right:.02778em>O</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size1">(</span></span><span class=mord><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141079999999999em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mord>∣</span><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=mord>∣</span><span class="mclose delimcenter" style=top:0><span class="delimsizing size1">)</span></span></span></span></span></span> 下降到了 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>O</mi><mrow><mo fence=true>(</mo><mi>N</mi><mi mathvariant=normal>∣</mi><mi>v</mi><mi mathvariant=normal>∣</mi><mo>+</mo><mi>λ</mi><msup><mi>N</mi><mn>2</mn></msup><mi>log</mi><mo>⁡</mo><mi>N</mi><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>O\left(N|v|+\lambda N^2 \log N\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.20001em;vertical-align:-.35001em></span><span class="mord mathdefault" style=margin-right:.02778em>O</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size1">(</span></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mord>∣</span><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=mord>∣</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span><span class="mord mathdefault">λ</span><span class=mord><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141079999999999em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mop>lo<span style=margin-right:.01389em>g</span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class="mclose delimcenter" style=top:0><span class="delimsizing size1">)</span></span></span></span></span></span>。ABA 基于 CC(Common Coin, 公共掷币) 实现，复杂度为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>O</mi><mo stretchy=false>(</mo><mi>N</mi><mi>λ</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>O(N \lambda)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathdefault" style=margin-right:.02778em>O</span><span class=mopen>(</span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class="mord mathdefault">λ</span><span class=mclose>)</span></span></span></span></p></li><li><p>因此，当输入大小 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>∣</mi><mi>v</mi><mi mathvariant=normal>∣</mi><mo>=</mo><mfrac><mrow><mi mathvariant=normal>∣</mi><mi>B</mi><mi mathvariant=normal>∣</mi></mrow><mi>N</mi></mfrac><mo>≫</mo><mi>λ</mi><mi>N</mi><mi>log</mi><mo>⁡</mo><mi>N</mi></mrow><annotation encoding=application/x-tex>|v|=\frac{|B|}{N} \gg \lambda N \log N</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>∣</span><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=mord>∣</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:1.355em;vertical-align:-.345em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.01em><span style=top:-2.6550000000000002em><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style=margin-right:.10903em>N</span></span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.485em><span class=pstrut style=height:3em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight" style=margin-right:.05017em>B</span><span class="mord mtight">∣</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.345em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>≫</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class="mord mathdefault">λ</span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mop>lo<span style=margin-right:.01389em>g</span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span></span></span></span> 时，总时间复杂度约为 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>O</mi><mrow><mo fence=true>(</mo><msup><mi>N</mi><mn>2</mn></msup><mi mathvariant=normal>∣</mi><mi>v</mi><mi mathvariant=normal>∣</mi><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>O\left(N^2|v|\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.20001em;vertical-align:-.35001em></span><span class="mord mathdefault" style=margin-right:.02778em>O</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size1">(</span></span><span class=mord><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141079999999999em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mord>∣</span><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=mord>∣</span><span class="mclose delimcenter" style=top:0><span class="delimsizing size1">)</span></span></span></span></span></span></p></li></ul><div align=center><img src=/img/post/拜占庭共识中的“蜜獾”/总体设计2.png style=zoom:50%></div><ol><li>每个节点首先从本地的交易池中选取前 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>∣</mi><mi>B</mi><mi mathvariant=normal>∣</mi></mrow><annotation encoding=application/x-tex>|B|</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>∣</span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord>∣</span></span></span></span> 个合法的交易，之后再从这 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>∣</mi><mi>B</mi><mi mathvariant=normal>∣</mi></mrow><annotation encoding=application/x-tex>|B|</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>∣</span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord>∣</span></span></span></span> 个交易中<strong>随机选择 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>∣</mi><mi>B</mi><mi mathvariant=normal>/</mi><mi>N</mi><mi mathvariant=normal>∣</mi></mrow><annotation encoding=application/x-tex>|B/N|</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>∣</span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord>/</span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mord>∣</span></span></span></span> 笔交易</strong>作为自己的提案</li></ol><ul><li>每个节点只选择 [𝐵/𝑁] 笔交易是为了<strong>降低通信复杂度</strong></li><li>采用随机选取的方式，是为了<strong>降低每个节点选择重复交易的概率</strong></li></ul><ol start=2><li>通过一个共享公钥通过<strong>门限加密</strong>将提案加密，交易的内容直到共识结束后（收到了来自 𝑓+1 个 解密分享）才能被解密</li></ol><ul><li>采用门限加密的方式，是为了<strong>防止审查攻击</strong></li></ul><ol start=3><li><p>每个节点将加密后的提案作为 <strong>ACS 模块</strong>的输入，输出就得到了一个“名单”，记录了有哪些节点提交的提案成功得到共识。</p></li><li><p>之后通过一系列的<strong>解密操作</strong>就得到了最终确认的区块。</p></li></ol><h3 id=异步公共子集-acs><a class=markdownIt-Anchor href=#异步公共子集-acs></a> 异步公共子集 ACS</h3><ul><li>一个 ACS 协议满足以下属性：<ul><li>有效性: 如果一个正确的节点输出一个集合 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>v</mi></mrow><annotation encoding=application/x-tex>v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.03588em>v</span></span></span></span> ，那么 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi mathvariant=normal>∣</mi><mi>v</mi><mi mathvariant=normal>∣</mi><mo>≥</mo><mi>N</mi><mo>−</mo><mi>f</mi></mrow><annotation encoding=application/x-tex>|v| \geq N-f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>∣</span><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=mord>∣</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>≥</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:.76666em;vertical-align:-.08333em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.10764em>f</span></span></span></span> 且 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>v</mi></mrow><annotation encoding=application/x-tex>v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.03588em>v</span></span></span></span> 包含至少 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi><mo>−</mo><mn>2</mn><mi>f</mi></mrow><annotation encoding=application/x-tex>N-2 f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.76666em;vertical-align:-.08333em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class=mord>2</span><span class="mord mathdefault" style=margin-right:.10764em>f</span></span></span></span> 个正确节点的输入。</li><li>一致性：如果一个正确的节点输出 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>v</mi></mrow><annotation encoding=application/x-tex>v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.03588em>v</span></span></span></span> ，那么每个节点都输出 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>v</mi></mrow><annotation encoding=application/x-tex>v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.03588em>v</span></span></span></span> 。</li><li>全局性：如果 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi><mo>−</mo><mi>f</mi></mrow><annotation encoding=application/x-tex>N-f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.76666em;vertical-align:-.08333em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.10764em>f</span></span></span></span> 个正确节点接收到一个输入，那么所有正确节点都会产生一个输出。</li></ul></li></ul><div align=center><img src=/img/post/拜占庭共识中的“蜜獾”/ACS1.png style=zoom:50%></div><ul><li>使用 Ben-Or 提出的 ACS 实现：通过 RBC 广播交易，通过 ABA 形成一致的二进制交易表<ul><li>每个节点都通过一个 RBC 协议广播自己的输入值（总共 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=application/x-tex>n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class="mord mathdefault">n</span></span></span></span> 个并发的 RBC 协议）</li><li>与此同时所有节点并发运行 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>n</mi></mrow><annotation encoding=application/x-tex>n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class="mord mathdefault">n</span></span></span></span> 个 ABA 协议来决定在共识结果中输出哪些节点广播的输入值。</li></ul></li></ul><div class="note note-info"><ul><li>算法 ACS（对于某一参与方 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi mathvariant=script>P</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>\mathcal{P}_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathcal" style=margin-right:.08222em>P</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>）<ul><li>让 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mo fence=true>{</mo><mi>R</mi><mi>B</mi><msub><mi>C</mi><mi>i</mi></msub><mo fence=true>}</mo></mrow><mi>N</mi></msub></mrow><annotation encoding=application/x-tex>\left\{RBC_i\right\}_N</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0497em;vertical-align:-.29969999999999997em></span><span class=minner><span class=minner><span class="mopen delimcenter" style=top:0>{</span><span class="mord mathdefault" style=margin-right:.00773em>R</span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathdefault" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>}</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.17863099999999998em><span style=top:-2.4003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.10903em>N</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.29969999999999997em><span></span></span></span></span></span></span></span></span></span> 指代可靠广播协议的 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi></mrow><annotation encoding=application/x-tex>N</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.10903em>N</span></span></span></span> 个实例，其中 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi mathvariant=script>P</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>\mathcal{P}_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathcal" style=margin-right:.08222em>P</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 是 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>R</mi><mi>B</mi><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>RBC_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class="mord mathdefault" style=margin-right:.00773em>R</span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathdefault" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 的发送方。让 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mo fence=true>{</mo><mi>B</mi><msub><mi>A</mi><mi>i</mi></msub><mo fence=true>}</mo></mrow><mi>N</mi></msub></mrow><annotation encoding=application/x-tex>\left\{BA_i\right\}_N</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0497em;vertical-align:-.29969999999999997em></span><span class=minner><span class=minner><span class="mopen delimcenter" style=top:0>{</span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathdefault">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>}</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.17863099999999998em><span style=top:-2.4003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.10903em>N</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.29969999999999997em><span></span></span></span></span></span></span></span></span></span> 指代二元共识协议的 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi></mrow><annotation encoding=application/x-tex>N</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.10903em>N</span></span></span></span> 个实例。</li></ul></li></ul><ol><li><p>在接收到输入 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>v_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.58056em;vertical-align:-.15em></span><span class=mord><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 后，将 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>v_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.58056em;vertical-align:-.15em></span><span class=mord><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 输入 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>R</mi><mi>B</mi><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>RBC_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class="mord mathdefault" style=margin-right:.00773em>R</span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathdefault" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></p></li><li><p>在从 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>R</mi><mi>B</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>RBC_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.969438em;vertical-align:-.286108em></span><span class="mord mathdefault" style=margin-right:.00773em>R</span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathdefault" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span></span></span></span> 传送 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>v_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.716668em;vertical-align:-.286108em></span><span class=mord><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span></span></span></span> 时，如果尚未向 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>B</mi><msub><mi>A</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>BA_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.969438em;vertical-align:-.286108em></span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathdefault">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span></span></span></span> 提供输入，则向 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>B</mi><msub><mi>A</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>BA_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.969438em;vertical-align:-.286108em></span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathdefault">A</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span></span></span></span> 提供输入 1。</p></li><li><p>在从<strong>至少</strong> <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi><mo>−</mo><mi>f</mi></mrow><annotation encoding=application/x-tex>N-f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.76666em;vertical-align:-.08333em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.10764em>f</span></span></span></span> 个 BA 实例传递值 1 时，向尚未提供输入的每个 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>B</mi><mi>A</mi></mrow><annotation encoding=application/x-tex>BA</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class="mord mathdefault">A</span></span></span></span> 实例提供输入 0。</p></li><li><p>一旦 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>B</mi><mi>A</mi></mrow><annotation encoding=application/x-tex>BA</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class="mord mathdefault">A</span></span></span></span> 的所有实例都完成，令 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>C</mi><mo>⊂</mo><mo stretchy=false>[</mo><mn>1..</mn><mi>N</mi><mo stretchy=false>]</mo></mrow><annotation encoding=application/x-tex>C \subset [1 . . N]</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.72243em;vertical-align:-.0391em></span><span class="mord mathdefault" style=margin-right:.07153em>C</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>⊂</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>[</span><span class=mord>1</span><span class=mord>.</span><span class=mord>.</span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mclose>]</span></span></span></span> 为每个交付 1 的BA 的索引。<strong>等待</strong>每个 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>R</mi><mi>B</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>RBC_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.969438em;vertical-align:-.286108em></span><span class="mord mathdefault" style=margin-right:.00773em>R</span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathdefault" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span></span></span></span> 的输出 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>v_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.716668em;vertical-align:-.286108em></span><span class=mord><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span></span></span></span> 使得 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>j</mi><mo>∈</mo><mi>C</mi></mrow><annotation encoding=application/x-tex>j \in C</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.85396em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.07153em>C</span></span></span></span>。最后输出 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mo>∪</mo><mrow><mi>j</mi><mo>∈</mo><mi>C</mi></mrow></msub><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>\cup_{j \in C} v_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8416680000000001em;vertical-align:-.286108em></span><span class=mord><span class=mbin>∪</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.328331em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span><span class="mrel mtight">∈</span><span class="mord mathdefault mtight" style=margin-right:.07153em>C</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class=mord><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span></span></span></span>。</p></li></ol></div><div class="note note-primary"><p><strong>等待</strong>每个 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>R</mi><mi>B</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>RBC_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.969438em;vertical-align:-.286108em></span><span class="mord mathdefault" style=margin-right:.00773em>R</span><span class="mord mathdefault" style=margin-right:.05017em>B</span><span class=mord><span class="mord mathdefault" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span></span></span></span> 的输出 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi>v</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>v_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.716668em;vertical-align:-.286108em></span><span class=mord><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span></span></span></span> 使得 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>j</mi><mo>∈</mo><mi>C</mi></mrow><annotation encoding=application/x-tex>j \in C</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.85396em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.05724em>j</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>∈</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.07153em>C</span></span></span></span>。是因为<strong>正确的节点可能会观察到广播以不同的顺序完成</strong></p><div align=center><img src=/img/post/拜占庭共识中的“蜜獾”/ACS2.png style=zoom:50%></div><ul><li>a. <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>R</mi><mi mathvariant=normal>B</mi><mi mathvariant=normal>C</mi></mrow><mn>1</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{RBC}_1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">R</span><span class="mord mathrm">B</span><span class="mord mathrm">C</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 结束比较早: 相对应的 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>A</mi><mi mathvariant=normal>B</mi><mi mathvariant=normal>A</mi></mrow><mn>1</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{ABA}_1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">A</span><span class="mord mathrm">B</span><span class="mord mathrm">A</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 的输入为 1， 其输出也 是 1</li><li>b. <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>R</mi><mi mathvariant=normal>B</mi><mi mathvariant=normal>C</mi></mrow><mn>2</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{RBC}_2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">R</span><span class="mord mathrm">B</span><span class="mord mathrm">C</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 结束的比较慢: 节点已经收到 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi><mo>−</mo><mi>f</mi></mrow><annotation encoding=application/x-tex>N-f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.76666em;vertical-align:-.08333em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.10764em>f</span></span></span></span> 个输出 1，所以 对于 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>A</mi><mi mathvariant=normal>B</mi><mi mathvariant=normal>A</mi></mrow><mn>2</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{ABA}_2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">A</span><span class="mord mathrm">B</span><span class="mord mathrm">A</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 的输入为 0 。但由于其它个节点已经观察到 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>R</mi><mi mathvariant=normal>B</mi><mi mathvariant=normal>C</mi></mrow><mn>2</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{RBC}_2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">R</span><span class="mord mathrm">B</span><span class="mord mathrm">C</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 成功完成，对于 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>A</mi><mi mathvariant=normal>B</mi><mi mathvariant=normal>A</mi></mrow><mn>2</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{ABA}_2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">A</span><span class="mord mathrm">B</span><span class="mord mathrm">A</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 的输入为 1。因此节点最终对 对于 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>A</mi><mi mathvariant=normal>B</mi><mi mathvariant=normal>A</mi></mrow><mn>2</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{ABA}_2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">A</span><span class="mord mathrm">B</span><span class="mord mathrm">A</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 输 入 1，且等待 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>R</mi><mi mathvariant=normal>B</mi><mi mathvariant=normal>C</mi></mrow><mn>2</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{RBC}_2</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">R</span><span class="mord mathrm">B</span><span class="mord mathrm">C</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 完成</li><li>c. <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>R</mi><mi mathvariant=normal>B</mi><mi mathvariant=normal>C</mi></mrow><mn>3</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{RBC}_3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">R</span><span class="mord mathrm">B</span><span class="mord mathrm">C</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 失败：直到 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>R</mi><mi mathvariant=normal>B</mi><mi mathvariant=normal>C</mi></mrow><mn>3</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{RBC}_3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">R</span><span class="mord mathrm">B</span><span class="mord mathrm">C</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 完成之前， <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mrow><mi mathvariant=normal>B</mi><mi mathvariant=normal>A</mi></mrow><mn>3</mn></msub></mrow><annotation encoding=application/x-tex>\mathrm{BA}_3</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathrm">B</span><span class="mord mathrm">A</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 输出 0</li></ul></div><h3 id=可靠广播-rbc><a class=markdownIt-Anchor href=#可靠广播-rbc></a> 可靠广播 RBC</h3><ul><li>ACS 使用 RBC <strong>确保源节点能够可靠地将消息发送到所有节点</strong>，一个 RBC 协议满足以下属性：<ul><li>一致性：任意两个正确节点都收到来自源节点的相同的消息</li><li>全局性：只要有一个节点收到了来自源节点的消息，那么所有正确的节点最终都能收到这个消息</li><li>可信性：如果源节点是正确的，那么所有正确的节点收到的消息一定与源节点发送的消息一致</li></ul></li></ul><div align=center><img src=/img/post/拜占庭共识中的“蜜獾”/RBC1.png style=zoom:70%></div><ul><li><p>使用 Cachin 等人提出的基于纠删码的 RBC 实现:</p><ul><li>采用了 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo stretchy=false>(</mo><mi>N</mi><mo>−</mo><mn>2</mn><mi>f</mi><mo separator=true>,</mo><mi>N</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>(N-2 f, N)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>2</span><span class="mord mathdefault" style=margin-right:.10764em>f</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mclose>)</span></span></span></span> 纠删码 + Merkle 树模式</li><li>消息传递的模式仍然跟传统的 RBC 类 似，主要分成 <code>Initiate</code>、<code>Echo</code>、<code>Ready</code> 三个阶段，其中后两个阶段各经历一次 all-to-all 的广播</li><li>复杂度 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>O</mi><mrow><mo fence=true>(</mo><mi>N</mi><mi mathvariant=normal>∣</mi><mi>v</mi><mi mathvariant=normal>∣</mi><mo>+</mo><mi>λ</mi><msup><mi>N</mi><mn>2</mn></msup><mi>log</mi><mo>⁡</mo><mi>N</mi><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>O\left(N|v|+\lambda N^2 \log N\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.20001em;vertical-align:-.35001em></span><span class="mord mathdefault" style=margin-right:.02778em>O</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner><span class="mopen delimcenter" style=top:0><span class="delimsizing size1">(</span></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mord>∣</span><span class="mord mathdefault" style=margin-right:.03588em>v</span><span class=mord>∣</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span><span class="mord mathdefault">λ</span><span class=mord><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141079999999999em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mop>lo<span style=margin-right:.01389em>g</span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class="mclose delimcenter" style=top:0><span class="delimsizing size1">)</span></span></span></span></span></span> <strong>指导区块大小选择</strong></li></ul></li><li><p>纠删码：利用所有节点的带宽来平衡了 Leader 的带宽消耗</p></li></ul><div class="note note-info"><ul><li>算法 RBC（对于某一参与方 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi mathvariant=script>P</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>\mathcal{P}_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathcal" style=margin-right:.08222em>P</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>，发送方 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi mathvariant=script>P</mi><mrow><mi>s</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>r</mi></mrow></msub></mrow><annotation encoding=application/x-tex>\mathcal{P}_{sender}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathcal" style=margin-right:.08222em>P</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style=margin-right:.02778em>r</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>）</li><li>Initiate 阶段<ul><li>发送者 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi mathvariant=script>P</mi><mrow><mi>s</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>r</mi></mrow></msub></mrow><annotation encoding=application/x-tex>\mathcal{P}_{sender}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=mord><span class="mord mathcal" style=margin-right:.08222em>P</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style=margin-right:.02778em>r</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> 将加密后的交易块 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>v</mi></mrow><annotation encoding=application/x-tex>v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.03588em>v</span></span></span></span> 作为 RBC 的输入， 使用 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo stretchy=false>(</mo><mi>N</mi><mo>−</mo><mn>2</mn><mi>f</mi><mo separator=true>,</mo><mi>N</mi><mo stretchy=false>)</mo><mo>−</mo></mrow><annotation encoding=application/x-tex>(N-2 f, N)-</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>2</span><span class="mord mathdefault" style=margin-right:.10764em>f</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mclose>)</span><span class=mord>−</span></span></span></span>-纠删码技术生成 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi></mrow><annotation encoding=application/x-tex>N</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.10903em>N</span></span></span></span> 个数据块 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo fence=true>{</mo><msub><mi>s</mi><mi>i</mi></msub><mo fence=true>}</mo></mrow><annotation encoding=application/x-tex>\left\{s_i\right\}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=minner><span class="mopen delimcenter" style=top:0>{</span><span class=mord><span class="mord mathdefault">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>}</span></span></span></span></span></li><li>利用 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo fence=true>{</mo><msub><mi>S</mi><mi>j</mi></msub><mo fence=true>}</mo></mrow><annotation encoding=application/x-tex>\left\{S_j\right\}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.036108em;vertical-align:-.286108em></span><span class=minner><span class="mopen delimcenter" style=top:0>{</span><span class=mord><span class="mord mathdefault" style=margin-right:.05764em>S</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>}</span></span></span></span></span> 计算出默克尔树根 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>h</mi></mrow><annotation encoding=application/x-tex>h</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.69444em;vertical-align:0></span><span class="mord mathdefault">h</span></span></span></span> 和 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo fence=true>{</mo><msub><mi>S</mi><mi>j</mi></msub><mo fence=true>}</mo></mrow><annotation encoding=application/x-tex>\left\{S_j\right\}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.036108em;vertical-align:-.286108em></span><span class=minner><span class="mopen delimcenter" style=top:0>{</span><span class=mord><span class="mord mathdefault" style=margin-right:.05764em>S</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>}</span></span></span></span></span> 到 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>h</mi></mrow><annotation encoding=application/x-tex>h</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.69444em;vertical-align:0></span><span class="mord mathdefault">h</span></span></span></span> 的路径 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo fence=true>{</mo><msub><mi>b</mi><mi>j</mi></msub><mo fence=true>}</mo></mrow><annotation encoding=application/x-tex>\left\{b_j\right\}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.036108em;vertical-align:-.286108em></span><span class=minner><span class="mopen delimcenter" style=top:0>{</span><span class=mord><span class="mord mathdefault">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>}</span></span></span></span></span></li><li>发送 <span class=katex><span class=katex-mathml><math><semantics><mrow><mrow><mi mathvariant=bold>V</mi><mi mathvariant=bold>A</mi><mi mathvariant=bold>L</mi></mrow><mrow><mo fence=true>(</mo><mi>h</mi><mo separator=true>,</mo><msub><mi>b</mi><mi>j</mi></msub><mo separator=true>,</mo><msub><mi>s</mi><mi>j</mi></msub><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>\mathbf{VAL}\left(h, b_j, s_j\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.036108em;vertical-align:-.286108em></span><span class=mord><span class="mord mathbf" style=margin-right:.01597em>V</span><span class="mord mathbf">A</span><span class="mord mathbf">L</span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class="mord mathdefault">h</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class="mord mathdefault">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class="mord mathdefault">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>)</span></span></span></span></span> 到 <span class=katex><span class=katex-mathml><math><semantics><mrow><msub><mi mathvariant=script>P</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>\mathcal{P}_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.969438em;vertical-align:-.286108em></span><span class=mord><span class=mord><span class="mord mathcal" style=margin-right:.08222em>P</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span></span></span></span></li></ul></li><li>Echo 阶段<ul><li>收到 <span class=katex><span class=katex-mathml><math><semantics><mrow><mrow><mi mathvariant=bold>V</mi><mi mathvariant=bold>A</mi><mi mathvariant=bold>L</mi></mrow><mrow><mo fence=true>(</mo><mi>h</mi><mo separator=true>,</mo><msub><mi>b</mi><mi>j</mi></msub><mo separator=true>,</mo><msub><mi>s</mi><mi>j</mi></msub><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>\mathbf{VAL}\left(h, b_j, s_j\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.036108em;vertical-align:-.286108em></span><span class=mord><span class="mord mathbf" style=margin-right:.01597em>V</span><span class="mord mathbf">A</span><span class="mord mathbf">L</span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class="mord mathdefault">h</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class="mord mathdefault">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class="mord mathdefault">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>)</span></span></span></span></span>, 广播 <span class=katex><span class=katex-mathml><math><semantics><mrow><mrow><mi mathvariant=bold>E</mi><mi mathvariant=bold>C</mi><mi mathvariant=bold>H</mi><mi mathvariant=bold>O</mi></mrow><mrow><mo fence=true>(</mo><msub><mi>h</mi><mn>2</mn></msub><msub><mi>b</mi><mi>j</mi></msub><mo separator=true>,</mo><msub><mi>s</mi><mi>j</mi></msub><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>\mathbf{ECHO}\left(h_2 b_j, s_j\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.036108em;vertical-align:-.286108em></span><span class=mord><span class="mord mathbf">E</span><span class="mord mathbf">C</span><span class="mord mathbf">H</span><span class="mord mathbf">O</span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class=mord><span class="mord mathdefault">h</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mord><span class="mord mathdefault">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class="mord mathdefault">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>)</span></span></span></span></span> 到各方 <span class=katex><span class=katex-mathml><math><semantics><mrow><mo fence=true>{</mo><msub><mi mathvariant=script>P</mi><mi>j</mi></msub><mo fence=true>}</mo></mrow><annotation encoding=application/x-tex>\left\{\mathcal{P}_j\right\}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.036108em;vertical-align:-.286108em></span><span class=minner><span class="mopen delimcenter" style=top:0>{</span><span class=mord><span class=mord><span class="mord mathcal" style=margin-right:.08222em>P</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>}</span></span></span></span></span></li></ul></li><li>Ready 阶段<ul><li>收到 <span class=katex><span class=katex-mathml><math><semantics><mrow><mrow><mi mathvariant=bold>E</mi><mi mathvariant=bold>C</mi><mi mathvariant=bold>H</mi><mi mathvariant=bold>O</mi></mrow><mrow><mo fence=true>(</mo><mi>h</mi><mo separator=true>,</mo><msub><mi>b</mi><mi>j</mi></msub><mo separator=true>,</mo><msub><mi>s</mi><mi>j</mi></msub><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>\mathbf{ECHO}\left(h, b_j, s_j\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.036108em;vertical-align:-.286108em></span><span class=mord><span class="mord mathbf">E</span><span class="mord mathbf">C</span><span class="mord mathbf">H</span><span class="mord mathbf">O</span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class="mord mathdefault">h</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class="mord mathdefault">b</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord><span class="mord mathdefault">s</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.311664em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style=margin-right:.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.286108em><span></span></span></span></span></span></span><span class="mclose delimcenter" style=top:0>)</span></span></span></span></span> ，用默克尔树校验消息是否有效</li><li>当节点收到来自 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi><mo>−</mo><mi>f</mi></mrow><annotation encoding=application/x-tex>N-f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.76666em;vertical-align:-.08333em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.10764em>f</span></span></span></span> 个节点的有效 ECHO <span class=katex><span class=katex-mathml><math><semantics><mrow><mo fence=true>(</mo><mi>h</mi><mo separator=true>,</mo><mo>⋅</mo><mo separator=true>,</mo><mo>⋅</mo><mo fence=true>)</mo></mrow><annotation encoding=application/x-tex>\left(h, \cdot,\cdot\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class="mord mathdefault">h</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord>⋅</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord>⋅</span><span class="mclose delimcenter" style=top:0>)</span></span></span></span></span>, 选取 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi><mo>−</mo><mn>2</mn><mi>f</mi></mrow><annotation encoding=application/x-tex>N-2 f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.76666em;vertical-align:-.08333em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class=mord>2</span><span class="mord mathdefault" style=margin-right:.10764em>f</span></span></span></span> 个 ECHO 重新计算 <span class=katex><span class=katex-mathml><math><semantics><mrow><msup><mi>h</mi><mo mathvariant=normal>′</mo></msup></mrow><annotation encoding=application/x-tex>h^{\prime}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.751892em;vertical-align:0></span><span class=mord><span class="mord mathdefault">h</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.751892em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> 判断是否等于 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>h</mi></mrow><annotation encoding=application/x-tex>h</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.69444em;vertical-align:0></span><span class="mord mathdefault">h</span></span></span></span> ，如果相等且未发送过，则广播 <span class=katex><span class=katex-mathml><math><semantics><mrow><mrow><mi mathvariant=bold>R</mi><mi mathvariant=bold>E</mi><mi mathvariant=bold>A</mi><mi mathvariant=bold>D</mi><mi mathvariant=bold>Y</mi></mrow><mo stretchy=false>(</mo><mi>h</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>\mathbf{READY}(h)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathbf">R</span><span class="mord mathbf">E</span><span class="mord mathbf">A</span><span class="mord mathbf">D</span><span class="mord mathbf" style=margin-right:.02875em>Y</span></span><span class=mopen>(</span><span class="mord mathdefault">h</span><span class=mclose>)</span></span></span></span> 消息</li><li>当节点收到 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=application/x-tex>f+1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.10764em>f</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.64444em;vertical-align:0></span><span class=mord>1</span></span></span></span> 个 READY <span class=katex><span class=katex-mathml><math><semantics><mrow><mo stretchy=false>(</mo><mi>h</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>(h)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class="mord mathdefault">h</span><span class=mclose>)</span></span></span></span> ，如果末发送过 <span class=katex><span class=katex-mathml><math><semantics><mrow><mrow><mi mathvariant=bold>R</mi><mi mathvariant=bold>E</mi><mi mathvariant=bold>A</mi><mi mathvariant=bold>D</mi><mi mathvariant=bold>Y</mi></mrow><mo stretchy=false>(</mo><mi>h</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>\mathbf{READY}(h)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathbf">R</span><span class="mord mathbf">E</span><span class="mord mathbf">A</span><span class="mord mathbf">D</span><span class="mord mathbf" style=margin-right:.02875em>Y</span></span><span class=mopen>(</span><span class="mord mathdefault">h</span><span class=mclose>)</span></span></span></span> 消息，则广播 <span class=katex><span class=katex-mathml><math><semantics><mrow><mrow><mi mathvariant=bold>R</mi><mi mathvariant=bold>E</mi><mi mathvariant=bold>A</mi><mi mathvariant=bold>D</mi><mi mathvariant=bold>Y</mi></mrow><mo stretchy=false>(</mo><mi>h</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>\mathbf{READY}(h)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathbf">R</span><span class="mord mathbf">E</span><span class="mord mathbf">A</span><span class="mord mathbf">D</span><span class="mord mathbf" style=margin-right:.02875em>Y</span></span><span class=mopen>(</span><span class="mord mathdefault">h</span><span class=mclose>)</span></span></span></span> 消息</li><li>当节点收到 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>2</mn><mi>f</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=application/x-tex>2 f+1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class=mord>2</span><span class="mord mathdefault" style=margin-right:.10764em>f</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.64444em;vertical-align:0></span><span class=mord>1</span></span></span></span> 个 <span class=katex><span class=katex-mathml><math><semantics><mrow><mrow><mi mathvariant=bold>R</mi><mi mathvariant=bold>E</mi><mi mathvariant=bold>A</mi><mi mathvariant=bold>D</mi><mi mathvariant=bold>Y</mi></mrow><mo stretchy=false>(</mo><mi>h</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>\mathbf{READY}(h)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathbf">R</span><span class="mord mathbf">E</span><span class="mord mathbf">A</span><span class="mord mathbf">D</span><span class="mord mathbf" style=margin-right:.02875em>Y</span></span><span class=mopen>(</span><span class="mord mathdefault">h</span><span class=mclose>)</span></span></span></span> ，等待 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>N</mi><mo>−</mo><mi>f</mi></mrow><annotation encoding=application/x-tex>N-f</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.76666em;vertical-align:-.08333em></span><span class="mord mathdefault" style=margin-right:.10903em>N</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.10764em>f</span></span></span></span> 个有效 <span class=katex><span class=katex-mathml><math><semantics><mrow><mrow><mi mathvariant=bold>E</mi><mi mathvariant=bold>C</mi><mi mathvariant=bold>H</mi><mi mathvariant=bold>O</mi></mrow><mrow><mo fence=true>(</mo><mi>h</mi><mo separator=true>,</mo><mo>⋅</mo><mo separator=true>,</mo><mo>⋅</mo><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>\mathbf{ECHO}\left(h, \cdot,\cdot\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class="mord mathbf">E</span><span class="mord mathbf">C</span><span class="mord mathbf">H</span><span class="mord mathbf">O</span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner><span class="mopen delimcenter" style=top:0>(</span><span class="mord mathdefault">h</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord>⋅</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord>⋅</span><span class="mclose delimcenter" style=top:0>)</span></span></span></span></span> ，得到交易块 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>v</mi></mrow><annotation encoding=application/x-tex>v</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class="mord mathdefault" style=margin-right:.03588em>v</span></span></span></span></li></ul></li></ul></div><h3 id=异步二元共识-aba><a class=markdownIt-Anchor href=#异步二元共识-aba></a> 异步二元共识 ABA</h3><ul><li><p>ACS 使用 ABA <strong>让所有节点对于 0 或 1 达成共识</strong>，一个 ABA 协议满足以下属性：</p><ul><li>一致性：所有正确节点的输出相同</li><li>最终性: 如果所有正确节点都收到了输入，那么所有正确节点最终都会得到输出</li><li>可信性：如果任意正确节点的输出是 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=application/x-tex>b</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.69444em;vertical-align:0></span><span class="mord mathdefault">b</span></span></span></span>(0 或 1)，那么至少有一个正确节点的输入是 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=application/x-tex>b</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.69444em;vertical-align:0></span><span class="mord mathdefault">b</span></span></span></span></li></ul></li><li><p>使用 Moustefaoui 等人提出的基于公共掷币 CC 的 ABA 实现：</p><ul><li>当节点无法达成一致的时候借助一个外部的随机源 CC 做决定</li><li>使用 Cachin 等人基于门限签名方案的公共硬币 CC 实现</li><li>以 <span class=katex><span class=katex-mathml><math><semantics><mrow><mn>1</mn><mi mathvariant=normal>−</mi><msup><mn>2</mn><mrow><mi mathvariant=normal>−</mi><mi>k</mi></mrow></msup></mrow><annotation encoding=application/x-tex>1 − 2^{−k}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.9324379999999999em;vertical-align:-.08333em></span><span class=mord>1</span><span class=mord>−</span><span class=mord><span class=mord>2</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8491079999999999em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathdefault mtight" style=margin-right:.03148em>k</span></span></span></span></span></span></span></span></span></span></span></span> 的概率在 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>O</mi><mo stretchy=false>(</mo><mi>k</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>O(k)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathdefault" style=margin-right:.02778em>O</span><span class=mopen>(</span><span class="mord mathdefault" style=margin-right:.03148em>k</span><span class=mclose>)</span></span></span></span> 轮内完成协议</li></ul></li></ul><div align=center><img src=/img/post/拜占庭共识中的“蜜獾”/ABA.png style=zoom:70%></div><div class="note note-info"><ul><li>算法 CC<ul><li>sid 被假定为一个唯一的随机数，用作这个公共硬币的 “明文”</li><li>(可信设置阶段)：可信第三方生成公共公钥以及密钥分享，密钥分享发送给各方。</li><li>被调用 <code>GetCoin</code> 时，广播 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>T</mi><mi>h</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>h</mi><mi>o</mi><mi>l</mi><mi>d</mi><mi>S</mi><mi>i</mi><mi>g</mi><mi>n</mi><msub><mi>n</mi><mi>k</mi></msub><mo stretchy=false>(</mo><mi>s</mi><msub><mi>k</mi><mi>i</mi></msub><mo separator=true>,</mo><mi>s</mi><mi>i</mi><mi>d</mi><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>ThresholdSign n_{k}(s k_i, sid)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathdefault" style=margin-right:.13889em>T</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style=margin-right:.02778em>r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style=margin-right:.01968em>l</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style=margin-right:.05764em>S</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style=margin-right:.03588em>g</span><span class="mord mathdefault">n</span><span class=mord><span class="mord mathdefault">n</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style=margin-right:.03148em>k</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class="mord mathdefault">s</span><span class=mord><span class="mord mathdefault" style=margin-right:.03148em>k</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.31166399999999994em><span style=top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class=mclose>)</span></span></span></span></li><li>当收到至少 <span class=katex><span class=katex-mathml><math><semantics><mrow><mi>f</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding=application/x-tex>f+1</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class="mord mathdefault" style=margin-right:.10764em>f</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:.64444em;vertical-align:0></span><span class=mord>1</span></span></span></span> 个密钥共享时，将其生成签名 Sig，签名检验成功则输出签名</li></ul></li></ul></div><h2 id=一点想法><a class=markdownIt-Anchor href=#一点想法></a> 一点想法</h2><ul><li>HoneyBadgerBFT 称自己的方案为 “<strong>cherry-pick</strong>”，这点确实不假。几乎可以如剥洋葱一样，找到<strong>每一层</strong>算法的来源。</li></ul></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class=category-chains><span class=category-chain><a href=/categories/%E7%AC%94%E8%AE%B0/ class=category-chain-item>笔记</a></span></span></div><div class=post-meta><i class="iconfont icon-tags"></i> <a href=/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/ class=print-no-link>#区块链</a> <a href=/tags/%E5%85%B1%E8%AF%86/ class=print-no-link>#共识</a> <a href=/tags/%E5%BC%82%E6%AD%A5/ class=print-no-link>#异步</a></div></div><div class="license-box my-3"><div class=license-title><div>拜占庭共识中的“蜜獾”</div><div>https://justloseit.top/拜占庭共识中的“蜜獾”/</div></div><div class=license-meta><div class=license-meta-item><div>作者</div><div>Mobilis In Mobili</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年11月14日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2023年5月17日</div></div><div class=license-meta-item><div>许可协议</div><div><a class=print-no-link target=_blank href=https://creativecommons.org/licenses/by/4.0/ ><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-cc-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href=/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93%EF%BC%9A2022%E5%B9%B4%E6%88%91%E7%9A%84%E9%98%85%E8%AF%BB%C2%B7%E5%BD%B1%E8%A7%86%C2%B7%E6%B8%B8%E6%88%8F/ title=年度总结：2022年我的阅读·影视·游戏><i class="iconfont icon-arrowleft"></i> <span class=hidden-mobile>年度总结：2022年我的阅读·影视·游戏</span> <span class=visible-mobile>上一篇</span></a></article><article class="post-next col-6"><a href=/%E2%80%9C7%E5%A4%A9%E7%94%A8Go%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0Web%E6%A1%86%E6%9E%B6Gee%E2%80%9D%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/ title=“7天用Go从零实现Web框架Gee”学习记录><span class=hidden-mobile>“7天用Go从零实现Web框架Gee”学习记录</span> <span class=visible-mobile>下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id=comments><div id=valine></div><script type=text/javascript>Fluid.utils.loadComments("#valine",function(){Fluid.utils.createScript("https://lib.baomitu.com/valine/1.5.1/Valine.min.js",function(){var i=Object.assign({appId:"t4w421aIGl2GXkT0tSGoap5I-gzGzoHsz",appKey:"BpNeeVt0v3tKAbF1L6RTf94X",path:"window.location.pathname",placeholder:"说点什么",avatar:"hide",meta:["nick","mail","link"],requiredFields:[],pageSize:10,lang:"zh-CN",highlight:!0,recordIP:!1,serverURLs:"https://t4w421ai.lc-cn-n1-shared.com",emojiCDN:null,emojiMaps:null,enableQQ:!1},{el:"#valine",path:window.location.pathname});new Valine(i),Fluid.utils.waitElementVisible("#valine .vcontent",()=>{var i="#valine .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class=sidebar style=margin-left:-1rem><div id=toc><p class=toc-header><i class="iconfont icon-list"></i> <span>目录</span></p><div class=toc-body id=toc-body></div></div></aside></div></div></div><a id=scroll-top-button aria-label=TOP href=# role=button><i class="iconfont icon-arrowup" aria-hidden=true></i></a><div class="modal fade" id=modalSearch tabindex=-1 role=dialog aria-labelledby=ModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-lg" role=document><div class=modal-content><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type=button id=local-search-close class=close data-dismiss=modal aria-label=Close><span aria-hidden=true>&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type=text id=local-search-input class="form-control validate"> <label data-error=x data-success=v for=local-search-input>关键词</label></div><div class=list-group id=local-search-result></div></div></div></div></div></main><footer><div class=footer-inner><div class=footer-content><a href=https://hexo.io target=_blank rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href=https://github.com/fluid-dev/hexo-theme-fluid target=_blank rel="nofollow noopener"><span>Fluid</span></a></div><div class=statistics><span id=leancloud-site-pv-container style=display:none>总访问量 <span id=leancloud-site-pv></span> 次 </span><span id=leancloud-site-uv-container style=display:none>总访客数 <span id=leancloud-site-uv></span> 人</span></div><div class=beian><span><a href=http://beian.miit.gov.cn/ target=_blank rel="nofollow noopener"><a target=_blank rel=noopener href=https://beian.miit.gov.cn>京ICP备2021006744号-1</a> </a></span><span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802034644" rel="nofollow noopener" class=beian-police target=_blank><span style=visibility:hidden;width:0>|</span> <img src=/img/police_beian.png alt=police-icon> <span>京公网安备 11010802034644号</span></a></span></div></div></footer><script src=https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js></script><link rel=stylesheet href=https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src=https://lib.baomitu.com/jquery/3.6.4/jquery.min.js></script><script src=https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js></script><script src=/js/events.js></script><script src=/js/plugins.js></script><script src=https://lib.baomitu.com/typed.js/2.0.12/typed.min.js></script><script>(t=>{var e=Fluid.plugins.typing;(t=t.getElementById("subtitle"))&&e&&e(t.getAttribute("data-typed-text"))})((window,document))</script><script src=/js/img-lazyload.js></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script defer=defer src=/js/leancloud.js></script><script src=/js/local-search.js></script><script src=/js/boot.js></script><noscript><div class=noscript-warning>博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>